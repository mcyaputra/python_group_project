import unittest
from core.worldnews_api import NewsAPI
from unittest.mock import Mock, patch
import os

class TestWorldNewsAPI(unittest.TestCase):

    def setUp(self):
        news_api_key = os.environ.get('WORLDNEWS_API_KEY')
        self.news_api = NewsAPI(news_api_key)
   
    def test_search_news(self):

        data = {'offset': 0,
                'number': 5,
                'available': 7,
                'news': [{'id': 219198230,
                'title': 'Cannes 2024: Megalopolis movie review – Francis Ford Coppola’s wildly ambitious project comes to fruition',
                'text': '4/5 stars Francis Ford Coppola returns with a bang, with his long-cherished and divisive project Megalopolis. Unveiled in competition at the Cannes Film Festival, it is the director’s first film since 2011’s Twixt, and one he has dreamed of making since 1977. An intriguing blend of science fiction and political satire, it begins with a voice-over: “Our American Republic is not all that different from old Rome.” It is a conceit that Coppola pursues, with his lead character named Cesar Catalina (Adam Driver) and the setting a 21st century metropolis called New Rome. Surely a figure to be compared to Coppola, Catalina is an architect who schemes of creating a city of the future for the people, named Megalopolis. It is a unique vision, built with a substance called megalon, which some believe is unsafe. Catalina’s reputation is being called into question wherever he goes. Dubbed an “obsessive-compulsive wacko” and a “reckless dreamer”, he is gathering enemies like some collect stamps. Among the most powerful is Mayor Franklyn Cicero (Breaking Bad’s Giancarlo Esposito), whose daughter Julia (Nathalie Emmanuel) soon becomes the object of the architect’s desire. With nods to Shakespeare and other writers and thinkers across human history, Coppola’s erudite script will not be for some. Characters speak in aphorisms or poetical flourishes (“time, show me the future”), but it is an ornate style that you eventually ease into. Some of it does not work, plainly. But some of it is inspired. At one point, the film drifts into the arena of live theatre. At the screening this writer attended, an actor came on stage in front of the screen, a spotlight beamed on him. It seems unlikely this will be the case for every showing, but it was a thrilling moment, albeit one that some will call a baffling gimmick. Visually, there are sublime touches, like a shot of Megalopolis inside a snow globe or the sight of Driver, whose character can manipulate time, standing on the mechanics of a giant clock. Performance-wise, Megalopolis is all over the shop. Aubrey Plaza is excellent as a ruthless TV reporter, while Shia LaBeouf is barmy and over-the-top as a rival to Catalina – one who craves his power and influence. With chariot races, Elvis impersonators and party scenes to rival those in Damien Chazelle’s Babylon, this is a bonkers meditation on life, the universe and everything. With allusions to Citizen Kane, Coppola has crafted what might be a unique sign-off to one of cinema’s great careers. Megalopolis is daring, daft and never dull. Want more articles like this? Follow SCMP Film on Facebook',
                'summary': 'With nods to Shakespeare and Citizen Kane, Coppola mixes science fiction and satire in this long-awaited, daft but daring saga of an architect (Adam Driver) building a 21st century metropolis.',
                'url': 'https://www.scmp.com/lifestyle/entertainment/article/3262986/cannes-2024-megalopolis-movie-review-francis-ford-coppolas-wildly-ambitious-project-comes-fruition',
                'image': 'https://cdn.i-scmp.com/sites/default/files/d8/images/canvas/2024/05/17/25efab9c-6a74-4dfd-9bac-17f99479e2f9_b7f8378b.jpg',
                'video': None,
                'publish_date': '2024-05-17 00:30:34',
                'author': 'James Mottram',
                'authors': ['James Mottram'],
                'language': 'en',
                'source_country': 'cn',
                'sentiment': 0.57},
                {'id': 219164400,
                'title': 'Elon Musk deepfake crypto scam highlights risks to Hong Kong as AI-related fraud rises',
                'text': 'Last week, the Hong Kong Securities and Futures Commission (SFC) warned of a scam using deepfakes of Elon Musk touting a cryptocurrency trading platform called “Quantum AI”. The scam is old, but it highlights an alarming rise in the use of artificial intelligence (AI) to commit fraud – and Asia has proven particularly susceptible. In its public warning on May 8, the SFC said that Quantum AI makes claims of being able to earn “too-good-to-be-true” returns and the regulator made a request to the Hong Kong Police Force to block access to related websites and social media pages. The linked domains were inaccessible as of this week, and the Facebook groups appear to have been removed. There have already been multiple cases of deepfake-related incidents of fraud in Hong Kong, putting the government on alert. Deepfake incidents in Asia-Pacific surged 1,530 per cent last year, with Vietnam and Japan seeing the most attacks, according to a report from identity verification platform Sumsub. “Thanks to increasing digital financial transactions in the emerging Asia market, there is a larger pool for deepfake targets,” said Penny Chai, Sumsub’s vice-president of business development in APAC. “Since a high volume of instant cross-border transactions takes place in the region, especially in Hong Kong, deepfake scammers can leverage the complexity and volume of financial dealings to carry out fraudulent activities.” The Quantum AI scam dates back at least a year, although it seems to be recycled with different variations used to target different groups. One video spread on Facebook last year, debunked by PolitiFact, featured Musk, the billionaire CEO of Tesla and SpaceX, alongside Jack Ma – co-founder of Alibaba Group Holding, owner of the South China Morning Post – promoting the platform. It was modified from a video of Musk and Ma appearing together at the 2019 World AI Conference in Shanghai. Another video was modified from an appearance Musk made on the Fox News show of conservative pundit Tucker Carlson, according to Reuters Fact Check. Some of the domains using the scheme rely on cheap hosting providers and flexible back-end technologies like WordPress. One of the top search results for Quantum AI is a website saying it requires a US$250 minimum deposit, accompanied by a warning that users should “invest only what you’re okay with losing completely”. Incidents of fraud using deepfakes – convincing simulacra of real people using generative AI – are on the rise. Sumsub – which tracks incidents of identity fraud, including through the use of deepfakes – detected a tenfold increase in the use of deepfakes last year, according to its Identity Fraud report. Sumsub identified Hong Kong as one of the top five markets in Asia for identity fraud at a rate of 3.3 per cent last year. Bangladesh had the highest at 5.4 per cent. In the first quarter, fintech industry fraud in Hong Kong grew at a rate of 3.8 per cent, which was 216 per cent faster than the rate in the same period a year earlier, Sumsub told the Post. Deepfakes have already caused tens of millions of dollars in losses in the city. In 2020, a manager at a Japanese bank was fooled by fake audio mimicking his director’s voice into transferring US$35 million. Another multinational company lost US$25.6 million to a fraud involving a deepfake video call mimicking the likeness of the chief financial officer. The SFC has become increasingly hawkish in flagging crypto-related scams on its website. Of the 29 suspicious virtual asset trading platforms listed by the SFC, 18 of the warnings were issued this year, and 24 of them were issued since JPEX scandal last September. That incident tied the JPEX cryptocurrency exchange to the loss of roughly HK$1.5 billion (US$192 million), making it one of the largest financial frauds in the city’s history. The regulator has also been more active in flagging other suspicious crypto-related products. On Monday, it warned of an investment product called LENA Network that involves cryptocurrency staking, borrowing and lending arrangements. Arrangements for staking, which requires locking up a certain amount of crypto to validate transactions on a blockchain, could “amount to unauthorised collective investment schemes”, the SFC warned, and “may be highly risky”.',
                'summary': 'The Securities and Futures Commission has warned of a fraudulent crypto trading platform called Quantum AI, a long-time scam that uses deepfakes of Elon Musk.',
                'url': 'https://www.scmp.com/tech/tech-trends/article/3262919/elon-musk-deepfake-crypto-scam-highlights-risks-hong-kong-ai-related-fraud-rises',
                'image': 'https://cdn.i-scmp.com/sites/default/files/d8/images/canvas/2024/05/16/960ab669-92c6-4854-ba2d-f49e8b15f207_58d8799c.jpg',
                'video': None,
                'publish_date': '2024-05-16 23:00:10',
                'author': 'Matt Haldane',
                'authors': ['Matt Haldane'],
                'language': 'en',
                'source_country': 'cn',
                'sentiment': -0.454},
                {'id': 219140992,
                'title': "Coppola's long-awaited epic 'Megalopolis' divides Cannes",
                'text': 'Hollywood titan Francis Ford Coppola returned to the Cannes Film Festival on Thursday to unveil his enormously hyped, wildly experimental and deeply divisive "Megalopolis". The 85-year-old director\'s arrival at the world-famous movie festival -- where decades earlier he twice scooped the top prize Palme d\'Or -- has been the frenzied talk on cafe terraces in the swanky Cote d\'Azur city. Would the epic $120-million project that he self-funded, and that has been gestating for some 40 years, be another masterpiece emerging from chaos, like "Apocalypse Now" all those decades ago? Or would the film that Coppola sold part of his California wine estate to create be a chaotic mess? One early press screening attended by AFP was greeted with both jeering boos and enthusiastic applause. In early reviews, Deadline hailed "a true modern masterwork of the kind that outrages with its sheer audacity," but The Guardian called the film "bloated, boring and bafflingly shallow." The Hollywood Reporter said the film was "a staggeringly ambitious big swing, if nothing else," while The Times of London ripped into its "nails-along-the-blackboard performances, word-salad dialogue and ugly visuals". The philosophical and unconventional movie will certainly leave many casual viewers deeply confused. "Megalopolis" takes place in New Rome, a parallel and decayed version of modern-day New York filled with bacchanalian parties, crumbling ancient statues, and a Madison Square Garden that hosts chariot races and Greco-Roman wrestling bouts. Adam Driver stars as Caesar Catalina, a cape-twirling Nobel Prize-winning architect hell-bent on using his seemingly magical powers to rebuild the collapsing urban sprawl into a utopian and futuristic Garden of Eden. Standing in his way is Frank Cicero, played by Giancarlo Esposito ("Breaking Bad"), an old-fashioned mayor who bitterly envies his visionary rival. The ensemble cast features Aubrey Plaza as a social-climbing journalist, Jon Voight as a mega-billionaire patriarch and Shia LaBeouf as a bratty scion with a penchant for populist politics. Coppola, one of Hollywood\'s most revered and mythologised directors, was greeted on the Croisette red carpet with a grand reception befitting an old master. Straw hat and cane in hand, he entered the packed world premiere -- the festival\'s hottest ticket -- having promised a film of operatic scale. As the lights dimmed it quickly became clear that "Megalopolis" was certainly his most ambitious film. He recently reeled off a list of influences that included Voltaire, Plato, Shakespeare, Hitchcock, Kubrick, Kurosawa, "Moses and the prophets all thrown in". And, indeed, the movie is packed with endless quotes and references from the Ancient Classics to Enlightenment philosophers and modern novelists. Dialogue flits from modern English to Shakespearean verse, and even Latin, and the drama is interspersed with archive footage ranging from the cosmos to Nazi rallies. At one highly unorthodox moment, events on the screen interact with those in the real-life theatre. Although Coppola has created several duds since his 1970s heyday, many still believe in his genius. "Cannes is important to him and he is important to Cannes. He comes as an artist," said festival head Thierry Fremaux. "Megalopolis" is one of 22 films competing for the Palme d\'Or, facing a jury led by "Barbie" director Greta Gerwig, who will announce their verdict on May 25. Also on Thursday, British director Andrea Arnold returned to Cannes with "Bird", chronicling a 12-year-old girl as she navigates a world of domestic violence, teen pregnancies and broken families. Channelling similar themes to her award-winning "Fish Tank", "Bird" adds fantastical, metaphorical and playful elements, including a flamboyant turn from Barry Keoghan ("Saltburn") as the girl\'s young father. A day earlier "Wild Diamond" -- also about a fragile teenage girl, but this time desperate to find fame on social media and reality TV -- was hailed by movie magazine Variety as "the arrival of a major filmmaker" in first-time French director Agathe Reidinger. There were also great reviews for "The Girl with the Needle", a bleak period drama about a factory worker desperately trying to get an abortion -- with a murderous twist. Still to come are a Donald Trump biopic, "The Apprentice", and new films from arthouse favourites David Cronenberg ("The Shrouds") and Italy\'s Paolo Sorrentino ("Parthenope"). Former Palme d\'Or winner Jacques Audiard will present "Emilia Perez", billed as a musical about a Mexican cartel boss having a sex change, starring Selena Gomez. © 2024 AFP',
                'summary': "Hollywood titan Francis Ford Coppola returned to the Cannes Film Festival on Thursday to unveil his enormously hyped, wildly experimental and deeply divisive &quot;Megalopolis&quot;.\nThe 85-year-old director's arrival…",
                'url': 'https://japantoday.com/category/entertainment/coppola%27s-epic-%27megalopolis%27-finally-arrives-at-cannes',
                'image': 'https://japantoday-asset.scdn3.secure.raxcdn.com/img/store/9e/25/98764184a2a8a8428f077b65e3e44dbfff77/9e2598764184a2a8a8428f077b65e3e44dbfff77/_w1700.jpg',
                'video': None,
                'publish_date': '2024-05-16 21:53:08',
                'author': 'Andrew Marszal, Japan Today Editor',
                'authors': ['Andrew Marszal', 'Japan Today Editor'],
                'language': 'en',
                'source_country': 'jp',
                'sentiment': 0.031},
                {'id': 219140984,
                'title': "Japan's 3 biggest carmakers eye tie-up over vehicle software",
                'text': 'Japan\'s three biggest automakers are considering collaborating over vehicle software to increase development efficiency as electric vehicles gain a growing share of the market, sources familiar with the matter said Thursday. Toyota Motor Corp, Honda Motor Co and Nissan Motor Co aim to standardize part of their software to promote collaboration with their parts suppliers and IT firms over vehicle controls and developing services, the sources said. The automakers are expected to unveil the tie-up at a study group meeting to be held by the industry ministry in the near future, the sources said. The potential collaboration between the major rivals appears to be a response to the rapid digitalization of cars in the United States and China. Their major overseas competitors, such as U.S. EV giant Tesla Inc and China\'s BYD Co, have been leading innovation in the car industry, where software plays an increasingly big role as more vehicles become electrified. Japan\'s industry and transportation ministries expect to include the potential collaboration in a digital strategy for the country\'s auto industry that they are currently drawing up. The initiative could expand to include other carmakers in Japan, the sources said. The tie-up is expected to revolve around application programming interfaces, or APIs, which link different software applications. Standardizing APIs will allow the automakers to reduce costs and use the same parts, such as sensors, across different brands, the sources said. The collaboration scheme comes on the heels of the surprise announcement in March by Honda and Nissan about a potential tie-up over EVs and software. "The automakers are feeling the need for increased collaboration," said one of the sources who declined to be named because the information is not public yet. "They are facing competition to make their specifications open to more parts makers and tech firms so the companies can develop products more easily and create various services for them," the source said. © KYODO',
                'summary': "Japan's three biggest automakers are considering collaborating over vehicle software to increase development efficiency as electric vehicles gain a growing share of the market, sources familiar with the…",
                'url': 'https://japantoday.com/category/tech/update1-japan%27s-3-biggest-carmakers-eye-tie-up-over-vehicle-software',
                'image': 'https://japantoday.com/images/japan-today-social.jpg',
                'video': None,
                'publish_date': '2024-05-16 21:50:33',
                'author': 'Japan Today Editor',
                'authors': ['Japan Today Editor'],
                'language': 'en',
                'source_country': 'jp',
                'sentiment': 0.063},
                {'id': 219140960,
                'title': 'Honda revs up on EVs, aiming for lucrative U.S., China markets',
                'text': 'Japanese automaker Honda reaffirmed its commitment to electric vehicles Thursday, saying it will invest 10 trillion yen ($65 billion) through fiscal 2031 to deliver EV models around the world, including the U.S. and China. “Honda has not changed its belief that EVs are the most effective solution in the area of small mobility products such as motorcycles and automobiles,” the Tokyo-based company said in a statement. By 2030, battery EVs and fuel cell EVs will make up 40% of Honda’s global auto sales, and it will have global production capacity for more than 2 million EVs, it said. The so-called “0 Series,” a key part of Honda’s EV strategy, will be a totally new EV series created from “zero,” Chief Executive Toshihiro Mibe told reporters in an online presentation. The 0 Series will be introduced in North America in 2026 and then rolled out globally, with seven models launched by 2030. In China, Honda will introduce 10 EV models by 2027, with 100% of its auto sales there EVs by 2035. “We will become a frontrunner in changing lifestyles to attain sustainability goals, not wait for someone else to tackle them,” Mibe told reporters. Despite some talk of a slowdown in electric vehicles in some markets, the move toward EVs remains solid in the long run, becoming dominant in the latter half of the 2020s, according to Honda, which makes Acura and Civic sedans and Gold Wing Tour motorcycles. Honda’s determination to pursue battery and fuel-cell EVs appears to contrast with domestic rival Toyota Motor Corp.’s more varied or “multiple” powertrains approach, focusing on hybrids and other models that still have engines. Honda is keeping hybrids in its lineup as it ramps up output of EVs, beefing up battery production, and making them thinner, aiming for zero accidents, Mibe said. Of the 10 trillion yen investment in the works, about 2 trillion yen will go into research and development on software and another 2 trillion ye into setting up comprehensive EV value chains in key markets such as the U.S., Canada and Japan. About 6 trillion yen ($39 billion) will go into “monozukuri,” or “the art of making things” in Japanese, such as the construction of next-generation EV production plants, electrification of motorcycles and EV model development, the company said. Mibe stressed Honda’s various partnerships, such as the one on developing EVs and intelligent driving technology with Japanese rival Nissan Motor Co., announced earlier this year. Honda announced Wednesday it signed a deal with IBM to work together on computer chips and software for future vehicles, meeting the upcoming demand for better processing and lower power consumption. “We are steadily and surely moving ahead to be prepared for electrification,” Mibe said. © Copyright 2024 The Associated Press. All rights reserved. This material may not be published, broadcast, rewritten or redistributed without permission.',
                'summary': 'Japanese automaker Honda\xa0reaffirmed its commitment to electric vehicles Thursday, saying it will invest 10 trillion yen ($65 billion) through fiscal 2031 to deliver EV models around the world,…',
                'url': 'https://japantoday.com/category/business/japanese-automaker-honda-revs-up-on-evs-aiming-for-lucrative-us-china-markets',
                'image': 'https://japantoday-asset.scdn3.secure.raxcdn.com/img/store/ca/b1/9a26a36952afd53870d3dd7fc8f902890aa6/2023-08-13T230153Z_1_LYNXMPEJ7C07D_RTROPTP_4_JAPAN-AUTOMAKERS-YEN_1/_w1700.jpg',
                'video': None,
                'publish_date': '2024-05-16 21:48:29',
                'author': 'Japan Today Editor, Yuri Kageyama',
                'authors': ['Japan Today Editor', 'Yuri Kageyama'],
                'language': 'en',
                'source_country': 'jp',
                'sentiment': -0.169}]}
        
        keyword1 = "Tesla" 
        keyword2 = "Toyota" 
        keyword3 = "Ford" 
        country1 = "Australia" 
        country2 = "" 
        country3 = "" 
        min_sentiment = -1 
        max_sentiment = 1 
        from_date = '2024-05-16' 
        to_date =  '2024-05-17' 
        article_to_show = 5 

        _, response = self.news_api.search_news(
                            keyword1=keyword1,
                            keyword2=keyword2,
                            keyword3=keyword3,
                            country1=country1,
                            country2=country2,
                            country3=country3,
                            min_sentiment=min_sentiment,
                            max_sentiment=max_sentiment,
                            from_date=from_date,
                            to_date=to_date,
                            article_to_show=article_to_show
                        )
        
        self.assertEqual(response, 200)

if __name__ == '__main__':
    unittest.main()